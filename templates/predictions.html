{% extends "base.html" %}

{% block title %}Vorhersagen - Football AI{% endblock %}

{% block extra_styles %}
<style>
    .page-header {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    }

    .page-header h1 {
        margin: 0 0 0.5rem 0;
        color: #1f2937;
    }

    .page-header p {
        margin: 0;
        color: #6b7280;
    }

    .filters {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        padding: 1.5rem;
        background: white;
        border-radius: 12px;
        margin-bottom: 2rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.12);
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        min-width: 200px;
    }

    .filter-label {
        font-size: 0.875rem;
        font-weight: 600;
        color: #6b7280;
    }

    select.filter-select {
        padding: 0.75rem 1rem;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 1rem;
        background: white;
        transition: all 0.3s;
        cursor: pointer;
    }

    select.filter-select:hover {
        border-color: #d1d5db;
    }

    select.filter-select:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .predictions-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
        gap: 1.5rem;
    }

    .prediction-card {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0,0,0,0.12);
        transition: transform 0.3s, box-shadow 0.3s;
        position: relative;
    }

    .prediction-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    }

    .card-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .league-info {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
    }

    .match-datetime {
        font-size: 0.875rem;
        opacity: 0.9;
    }

    .card-body {
        padding: 1.5rem;
    }

    .teams-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #f3f4f6;
    }

    .team-name {
        font-size: 1.125rem;
        font-weight: 600;
        color: #1f2937;
        flex: 1;
    }

    .team-home {
        text-align: right;
        padding-right: 1rem;
    }

    .team-away {
        text-align: left;
        padding-left: 1rem;
    }

    .vs-text {
        color: #9ca3af;
        font-size: 0.875rem;
        font-weight: 500;
    }

    .prediction-info {
        background: #f9fafb;
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
    }

    .info-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
    }

    .info-label {
        font-size: 0.875rem;
        color: #6b7280;
        font-weight: 500;
    }

    .info-value {
        font-weight: 600;
        font-size: 1rem;
        color: #1f2937;
    }

    .confidence-display {
        margin-top: 1rem;
        padding: 1rem;
        border-radius: 8px;
        text-align: center;
    }

    .confidence-high {
        background: #d1fae5;
        border: 2px solid #10b981;
    }

    .confidence-medium {
        background: #fef3c7;
        border: 2px solid #f59e0b;
    }

    .confidence-low {
        background: #fee2e2;
        border: 2px solid #ef4444;
    }

    .confidence-number {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
    }

    .confidence-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
    }

    .high-conf-badge {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: #10b981;
        color: white;
        padding: 0.375rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .odds-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5rem;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #e5e7eb;
    }

    .odds-item {
        text-align: center;
        padding: 0.75rem 0.5rem;
        background: #f9fafb;
        border-radius: 8px;
        transition: background 0.2s;
    }

    .odds-item:hover {
        background: #f3f4f6;
    }

    .odds-label {
        font-size: 0.75rem;
        color: #6b7280;
        margin-bottom: 0.25rem;
        font-weight: 500;
    }

    .odds-value {
        font-weight: 700;
        color: #3b82f6;
        font-size: 1.125rem;
    }

    .empty-state {
        grid-column: 1 / -1;
        text-align: center;
        padding: 4rem 2rem;
        background: white;
        border-radius: 16px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.12);
    }

    .empty-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
    }

    .empty-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.5rem;
    }

    .empty-text {
        color: #6b7280;
    }

    @media (max-width: 768px) {
        .predictions-container {
            grid-template-columns: 1fr;
        }
        
        .filters {
            flex-direction: column;
        }
        
        .filter-group {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Aktuelle Vorhersagen</h1>
    <p>Nächste Updates: Dienstag 14:00 und Freitag 18:00</p>
</div>

<div class="filters">
    <div class="filter-group">
        <label class="filter-label" for="leagueFilter">Liga</label>
        <select class="filter-select" id="leagueFilter">
            <option value="">Alle Ligen</option>
            {% if leagues %}
                {% for code, league in leagues.items() %}
                <option value="{{ code }}">
                    {{ league.emoji }} {{ league.name }}
                </option>
                {% endfor %}
            {% endif %}
        </select>
    </div>
    
    <div class="filter-group">
        <label class="filter-label" for="confidenceFilter">Confidence</label>
        <select class="filter-select" id="confidenceFilter">
            <option value="">Alle Vorhersagen</option>
            <option value="high">Nur High Confidence</option>
        </select>
    </div>
    
    {% if dates %}
    <div class="filter-group">
        <label class="filter-label" for="dateFilter">Datum</label>
        <select class="filter-select" id="dateFilter">
            <option value="">Alle Tage</option>
            {% for date in dates %}
            <option value="{{ date }}">{{ date }}</option>
            {% endfor %}
        </select>
    </div>
    {% endif %}
</div>

<div class="predictions-container">
    {% if predictions %}
        {% for pred in predictions %}
        <div class="prediction-card">
            {% if pred.get('High_conf') == 1 %}
            <div class="high-conf-badge">⭐ HIGH CONFIDENCE</div>
            {% endif %}
            
            <div class="card-header">
                <div class="league-info">
                    {% if pred.get('Div') and leagues and pred.get('Div') in leagues %}
                        <span>{{ leagues[pred.get('Div')].emoji }}</span>
                        <span>{{ leagues[pred.get('Div')].name }}</span>
                    {% else %}
                        <span>{{ pred.get('Div', 'Liga') }}</span>
                    {% endif %}
                </div>
                <div class="match-datetime">
                    {{ pred.get('Date', 'TBD') }} • {{ pred.get('Time', '15:30') }}
                </div>
            </div>
            
            <div class="card-body">
                <div class="teams-container">
                    <div class="team-name team-home">
                        {{ pred.get('HomeTeam', 'Heim') }}
                    </div>
                    <div class="vs-text">VS</div>
                    <div class="team-name team-away">
                        {{ pred.get('AwayTeam', 'Gast') }}
                    </div>
                </div>
                
                <div class="prediction-info">
                    <div class="info-row">
                        <span class="info-label">Vorhersage:</span>
                        <span class="info-value">
                            {% if pred.get('Prediction') == 'H' %}
                                Heimsieg
                            {% elif pred.get('Prediction') == 'D' %}
                                Unentschieden
                            {% elif pred.get('Prediction') == 'A' %}
                                Auswärtssieg
                            {% else %}
                                {{ pred.get('Prediction', 'N/A') }}
                            {% endif %}
                        </span>
                    </div>
                </div>
                
                {% if pred.get('Confidence') %}
                    {% if pred.get('Confidence') > 0.65 %}
                    <div class="confidence-display confidence-high">
                        <div class="confidence-number" style="color: #065f46;">
                            {{ (pred.get('Confidence') * 100)|int }}%
                        </div>
                        <div class="confidence-label" style="color: #065f46;">
                            HOHE ZUVERSICHT
                        </div>
                    </div>
                    {% elif pred.get('Confidence') > 0.50 %}
                    <div class="confidence-display confidence-medium">
                        <div class="confidence-number" style="color: #92400e;">
                            {{ (pred.get('Confidence') * 100)|int }}%
                        </div>
                        <div class="confidence-label" style="color: #92400e;">
                            MITTLERE ZUVERSICHT
                        </div>
                    </div>
                    {% else %}
                    <div class="confidence-display confidence-low">
                        <div class="confidence-number" style="color: #991b1b;">
                            {{ (pred.get('Confidence') * 100)|int }}%
                        </div>
                        <div class="confidence-label" style="color: #991b1b;">
                            NIEDRIGE ZUVERSICHT
                        </div>
                    </div>
                    {% endif %}
                {% endif %}
                
                <div class="odds-grid">
                    <div class="odds-item">
                        <div class="odds-label">Heim</div>
                        <div class="odds-value">
                            {{ pred.get('B365H', 'N/A') }}
                        </div>
                    </div>
                    <div class="odds-item">
                        <div class="odds-label">Unent.</div>
                        <div class="odds-value">
                            {{ pred.get('B365D', 'N/A') }}
                        </div>
                    </div>
                    <div class="odds-item">
                        <div class="odds-label">Gast</div>
                        <div class="odds-value">
                            {{ pred.get('B365A', 'N/A') }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <div class="empty-icon">📊</div>
            <h2 class="empty-title">Keine Vorhersagen verfügbar</h2>
            <p class="empty-text">Neue Vorhersagen werden bald generiert.</p>
            <p class="empty-text" style="margin-top: 0.5rem;">
                Nächste Updates: Dienstag 14:00 und Freitag 18:00
            </p>
        </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get filter elements
    var leagueFilter = document.getElementById('leagueFilter');
    var confidenceFilter = document.getElementById('confidenceFilter');
    var dateFilter = document.getElementById('dateFilter');
    
    // Get current filters from URL
    var urlParams = new URLSearchParams(window.location.search);
    
    // Set filter values from URL
    if (leagueFilter && urlParams.get('league')) {
        leagueFilter.value = urlParams.get('league');
    }
    if (confidenceFilter && urlParams.get('confidence')) {
        confidenceFilter.value = urlParams.get('confidence');
    }
    if (dateFilter && urlParams.get('date')) {
        dateFilter.value = urlParams.get('date');
    }
    
    // Apply filters function
    function applyFilters() {
        var params = new URLSearchParams();
        
        if (leagueFilter && leagueFilter.value) {
            params.set('league', leagueFilter.value);
        }
        if (confidenceFilter && confidenceFilter.value) {
            params.set('confidence', confidenceFilter.value);
        }
        if (dateFilter && dateFilter.value) {
            params.set('date', dateFilter.value);
        }
        
        var queryString = params.toString();
        var newUrl = '/predictions' + (queryString ? '?' + queryString : '');
        window.location.href = newUrl;
    }
    
    // Add event listeners if elements exist
    if (leagueFilter) {
        leagueFilter.addEventListener('change', applyFilters);
    }
    if (confidenceFilter) {
        confidenceFilter.addEventListener('change', applyFilters);
    }
    if (dateFilter) {
        dateFilter.addEventListener('change', applyFilters);
    }
});
</script>
{% endblock %}